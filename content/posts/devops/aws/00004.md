---
title: AWS CloudFormation
date: 2018-11-12T14:00:00+09:00
showDate: true
tags: ["AWS"]
---

# Flow
- Change AWS CLI Profile
- Create CloudFormation Template
- Create Stack

# Change AWS CLI Profile
- 管理コンソールより(root)、認証情報からIAMユーザのアクセスキーとシークレットアクセスキーを取得する
  (シークレットアクセスキーは、アクセスキーの生成時に一度しか表示されるないため、紛失した場合は、再度アクセスキーを取得し直す)
- ローカルのAWSプロファイルを更新する
  ```
  $ aws configure --profile pureone-worker
  AWS Access Key ID [None]:アクセスキー
  AWS Secret Access Key [None]:シークレットアクセスキー
  Default region name [None]:ap-northeast-1
  Default output format [None]:json
  ```

# Create CloudFormation Template

https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html

```

```

# Create Stack
- テンプレートとスタックは、オブジェクト指向でいうところの、クラスとインスタンスに近いイメージ

# Template
- AWSリソース構成を YAML or JSON で記載したドキュメント

## Section
- Paramters
  - 実行時に埋め込む変数値
- Mappings
  - 実行環境によって変わる値をMap形式で定義
- Resource
  - AWSリソース群を定義する

- 組み込み関数
  - Ref 他の要素の参照
  - FindInMap

- 擬似パラメータ
  - AWS::Region 汎用性

# Stack
- テンプレートから自動構築されたAWSリソースの集合

- 組み込み関数を使って環境に依存しないテンプレートを目指す
- リソース追加・変更は必ず CloudFormation で行う
- テンプレートをバージョン管理する
- システムの規模やライフサイクルによってテンプレートを分割する
- JSON or YAML
