<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="doc site by pureonedoya.">

<meta name="twitter:card" content="summary">
<meta name="twitter:domain" content="https://pureonedoya.github.io/doc-site/">

<meta name="twitter:image" content="https://pureonedoya.github.io/doc-site/tn.png">
<meta name="twitter:title" property="og:title" itemprop="title name" content="doc site">
<meta name="twitter:description" property="og:description" itemprop="description" content="doc site by pureonedoya.">
<meta name="og:type" content="website">
<meta name="og:url" content="https://pureonedoya.github.io/doc-site/">
<meta name="og:image" itemprop="image primaryImageOfPage" content="https://pureonedoya.github.io/doc-site/tn.png">

<link rel="shortcut icon" href="https://pureonedoya.github.io/doc-site/favicon.ico" id="favicon">
<link rel="stylesheet" href="https://pureonedoya.github.io/doc-site/css/style.css">


<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">


<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
</script>




    

    
    
    
    <title>
        
        クリーンアーキテクチャ
        
    </title>
</head>

<body>
    <div class="wrap">
        <div class="section" id="title">クリーンアーキテクチャ</div>

        
<div class="section" id="content">
    2018-10-31 (Wed) &#183; 236 words
    
    <div class="tag-container">
        
        <span class="tag">
            <a href="https://pureonedoya.github.io/doc-site/tags/clean-architecture">
                Clean Architecture
            </a>
        </span>
        
    </div>
    
    <hr/>
    

<p>Robert C. Martin</p>

<h1 id="クリーンアーキテクチャ">クリーンアーキテクチャ</h1>

<ul>
<li>ビジネスロジックの本質（業務上の関心）</li>
<li>入出力処理等の副作用の隔離</li>
</ul>

<p>クリーンアーキテクチャにおける方針
ビジネスロジックの明確化
フレームワークからの独立
外界との独立（ストアからの独立、UIからの独立）</p>

<h1 id="イントロダクション">イントロダクション</h1>

<ul>
<li>ソフトウェアを「一度だけ」動かすのは、難しいことではない</li>

<li><p>ソフトウェアを「正しく」動かすのは、とても難しい</p></li>

<li><p>ソフトウェアを正しくすると以下のようなことが発生する</p>

<ul>
<li>大量のエンジニアが不要になる</li>
<li>課題の管理が不要になる</li>
<li>欠陥（バグ）が減る</li>
<li>変更が容易になる</li>
<li>労力が最小になり、機能性と柔軟性は最大になる</li>
</ul></li>
</ul>

<h1 id="アーキテクチャ">アーキテクチャ</h1>

<ul>
<li>アーキテクチャの魅力は構造である</li>
<li>重要性は変更コストで表現できる</li>
<li>プログラムの構成要素をどのように組み立てるか</li>
</ul>

<h1 id="設計とアーキテクチャ">設計とアーキテクチャ</h1>

<ul>
<li>両者に違いはない</li>
<li>ソフトウェアアーキテクチャの目的は、システム開発・保守するための人材を必要最小限にすること</li>
</ul>

<h1 id="数値で見る崩壊とエンジニアの給料">数値で見る崩壊とエンジニアの給料</h1>

<ul>
<li>リリースごとに生産性は低下、エンジニアの給与は増加</li>
</ul>

<h1 id="価値">価値</h1>

<ul>
<li>完璧に動作するが変更できないソフトウェア（振る舞い）</li>

<li><p>完璧に動作しないが変更できるソフトウェア（アーキテクチャ）</p></li>

<li><p>ソフトウェア＝ソフトであるべき</p></li>

<li><p>アイゼンハワーのマトリクス</p>

<ul>
<li>振る舞いは、緊急だが重要ではない</li>
<li>アーキテクチャは、緊急ではないが重要である</li>
<li>よくある間違いは、緊急だが重要ではないタスクを最優先してしまうこと</li>
</ul></li>
</ul>

<h1 id="ソフトウェアアーキテクト">ソフトウェアアーキテクト</h1>

<ul>
<li>機能よりもその構造を重要視する</li>

<li><p>機能を簡単に開発・変更・拡張できる構造（アーキテクチャ）を構築する</p></li>

<li><p>コンポーネントの分離</p></li>

<li><p>データ管理</p></li>

<li><p>機能</p></li>

<li><p>ソフトウェアは科学である</p>

<ul>
<li>テストはバグが存在しないことを実証できないが、バグが存在することは実証できる</li>
<li>つまり反証可能なモジュール単位としての構造が大事</li>
</ul></li>
</ul>

<h1 id="ポリモーフィズムの利点-依存関係逆転の原則">ポリモーフィズムの利点＝依存関係逆転の原則</h1>

<ul>
<li>上位レベルの関数が下位レベルの関数を呼び出す場合、依存関係は <code>上位 -&gt; 下位</code> だが、インタフェースを使用することで、<code>下位 -&gt; 上位</code> に依存する</li>
<li>ビジネスルールがUI、DBに依存するのではなく、UI、DBがビジネスルールに依存するが正しい

<ul>
<li><code>UI -&gt; Business Rule &lt;- DB</code></li>
<li>依存関係逆転の原則は、ビジネスルールへの依存を制御する</li>
<li>独立デプロイ可能性</li>
</ul></li>
<li>OOは、ポリモーフィズムを使用してソースコードの依存関係を制御する能力のこと</li>
</ul>

<h1 id="関数型プログラミング">関数型プログラミング</h1>

<ul>
<li><p>不変性</p>

<ul>
<li>競合、デットロック、並行更新は、可変を許容する変数が原因</li>
<li>副作用のコンポーネントは分離し、トランザクション制御により、上記の問題は全て失敗させればいい</li>
</ul></li>

<li><p>イベントソーシング</p>

<ul>
<li>状態ではなく取引（トランザクション）を保存する戦略</li>
<li>ソースコードの管理システムと同じ</li>
<li>関数型である</li>
</ul></li>
</ul>

<h1 id="solid">SOLID</h1>

<h2 id="srp-single-responsibilty-principle-単一責任の原則">SRP (Single Responsibilty Principle) 単一責任の原則</h2>

<ul>
<li>モジュールを変更する理由はひとつだけでなければならない</li>
<li>モジュールはひとつのアクターに対して責務を負う
アクターがポイント</li>
<li>給与システムの例
<code>Scala
class Employee {
def calculatePay(pay: Pay): Unit
def reportHours(report: Report): Unit
def save(data: Data): Unit
}
</code></li>
<li><code>calculatePay()</code> は経理部が使用し、報告先は CFO</li>
<li><code>reportHours()</code> は人事部が使用し、報告先は COO</li>

<li><p><code>save()</code> はデータベース管理者が使用し、報告先は CTO</p></li>

<li><p>アクターが異なるため、上記の各メソッドは、別のクラスに分割するべき</p></li>

<li><p>データと関数に切り分け、分割する
-&gt; Facadeパターン</p></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Scala" data-lang="Scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeFacade</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> calculatePay <span style="color:#66d9ef">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PayCalculator</span><span style="color:#f92672">).</span>calculatePay
  <span style="color:#66d9ef">def</span> reportHours <span style="color:#66d9ef">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HourReporter</span><span style="color:#f92672">).</span>reportHours
  <span style="color:#66d9ef">def</span> save <span style="color:#66d9ef">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">EmployeeSaver</span><span style="color:#f92672">).</span>saveEmployee
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PayCalculator</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">def</span> calculatePay <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span> <span style="color:#75715e">// EmployeeData }
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HourReporter</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">def</span> reportHours <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span> <span style="color:#75715e">// EmployeeData }
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeSaver</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">def</span> saveEmployee <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span> <span style="color:#75715e">// EmployeeData }
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeData</span> <span style="color:#f92672">{}</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Scala" data-lang="Scala"><span style="color:#75715e">// データを内部にもつFacade
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeFacade</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> employData<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EmployeeData</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">EmployeeData</span><span style="color:#f92672">()</span>
  <span style="color:#66d9ef">def</span> calculatePay <span style="color:#66d9ef">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PayCalculator</span><span style="color:#f92672">).</span>calculatePay
  <span style="color:#66d9ef">def</span> reportHours <span style="color:#66d9ef">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HourReporter</span><span style="color:#f92672">).</span>reportHours
  <span style="color:#66d9ef">def</span> save <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PayCalculator</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">def</span> calculatePay <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span> <span style="color:#75715e">// EmployeeData }
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HourReporter</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">def</span> reportHours <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span> <span style="color:#75715e">// EmployeeData }
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeData</span> <span style="color:#f92672">{}</span></code></pre></div>
<h2 id="ocp-open-closed-principle-オープン-クローズドの原則">OCP (Open-Closed Principle) オープン・クローズドの原則</h2>

<ul>
<li>ソフトウェアの構成要素は、拡張に対しては開いていて、修正に対しては閉じていなければならない</li>
<li>ソフトウェアの振る舞いは、既存の成果物を変更せず拡張できるようにすべきである</li>
<li>コンポーネントの関係を単方向にする</li>
</ul>

<h2 id="lsp-liskov-substitution-principle-リスコフの置換原則">LSP (Liskov Substitution Principle) リスコフの置換原則</h2>

<p>-</p>

<h2 id="isp-interface-segregation-principle-インタフェース分離の原則">ISP (Interface Segregation Principle) インタフェース分離の原則</h2>

<h2 id="dip-dependency-inversion-principle-依存関係逆転の原則">DIP (Dependency Inversion Principle) 依存関係逆転の原則</h2>

<ul>
<li>下位レベルのモジュールは、上位レベルのモジュールに依存するべき</li>
</ul>

</div>


        
<div class="section bottom-menu">
    
<hr />
<p>

    <a href="https://pureonedoya.github.io/doc-site/">
    Top</a>
    &nbsp;&nbsp;&nbsp;
    
        <a href="/doc-site/posts">back</a>
        
            &nbsp;&nbsp;&nbsp;
        
    

    <a href="https://pureonedoya.github.io/doc-site/posts">Posts</a>
      &nbsp;&nbsp;&nbsp;
    <a href="https://pureonedoya.github.io/doc-site/tags">Tags</a>
      &nbsp;&nbsp;&nbsp;
    <a href="https://pureonedoya.github.io/doc-site/about">About Me</a>
</p>

</div>


        <div class="section footer">&copy; 2018 pureonedoya.</div>
    </div>
</body>

</html>